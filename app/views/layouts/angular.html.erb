<!DOCTYPE html>
<html lang="en" data-ng-app="myApp">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta id="version" name="version" content="<%= @appVersion %>" >
    <title>Imua</title>

    <%= csrf_meta_tags %>
    <%= stylesheet_link_tag "application", :media => "all" %>
    <%= javascript_include_tag "application" %>
    <%= favicon_link_tag 'favicon.ico' %>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">

    <script type="text/javascript" src="//use.typekit.net/nck0oiv.js"></script>
    <!--<script type="text/javascript" src="//use.typekit.net/kmx1vmk.js"></script>-->
    <script type="text/javascript">try{Typekit.load();}catch(e){}</script>

    <base href="/">
  </head>
  <body ng-controller="AppController">
    <header ng-controller="HeaderController">
      <div class="wrapper clear">
        <div class="imua-logo left">
          <a href="/">
            <%= image_tag "logo-blue-small.png", :alt => "IMUA", :height=>'46px', :width=>'46px' %>
            <% if current_user.super_admin? %>
              Collective Progress
            <% else %>
              <%= current_user.organization.name %>
            <% end %>
          </a>
        </div>

        <nav class="nav-collapsed right" role="navigation">
          <div class="dropdown js-cog">
            <div class="current-name">
              Menu <span class="caret"></span>
            </div>
            <div class="submenu js-submenu">
              <% if current_user.super_admin? %>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/sa/organizations">Organizations</a>
                </div>
              <% end %>

              <% if current_user.org_admin? %>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/dashboard/<%= current_user.id %>">Home</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/organization/<%= current_user.organization_id %>">Mentors</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/students/<%= current_user.organization_id %>">Students</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/roadmap/<%= current_user.organization_id %>">Organization Setup</a>
                </div>
              <% end %>

              <% if current_user.mentor? %>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/dashboard/<%= current_user.id %>">My Students</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/assignments/<%= current_user.id %>">My Tasks</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/roadmap/<%= current_user.organization_id %>">Our Roadmap</a>
                </div>
              <% end %>

              <% if current_user.student? %>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/dashboard/<%= current_user.id %>">Home</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/progress/<%= current_user.id %>">My Progress</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/expectations/<%= current_user.id %>">My Expectations</a>
                </div>
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/user_assignments/<%= current_user.id %>">My Tasks</a>
                </div>
              <% end %>
              <div class="submenu__link">
                <a class="js-nav-link" href="#/profile/<%= current_user.id %>">Profile</a>
              </div>
              <div class="submenu__link">
                <%= link_to('Logout', destroy_user_session_path, :method => :delete) %>
              </div>
            </div>
          </div>
        </nav>

        <nav class="nav-expanded right" role="navigation">
          <ul>
            <% if current_user.super_admin? %>
              <li>
                <a class="js-nav-link" href="#/sa/organizations">Organizations</a>
              </li>
            <% end %>

            <% if current_user.org_admin? %>
              <li>
                <a class="js-nav-link" href="#/dashboard/<%= current_user.id %>">Home</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/organization/<%= current_user.organization_id %>">Mentors</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/students/<%= current_user.organization_id %>">Students</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/roadmap/<%= current_user.organization_id %>">Organization Setup</a>
              </li>
            <% end %>

            <% if current_user.mentor? %>
              <li>
                <a class="js-nav-link" href="#/dashboard/<%= current_user.id %>">My Students</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/assignments/<%= current_user.id %>">My Tasks</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/roadmap/<%= current_user.organization_id %>">Our Roadmap</a>
              </li>
            <% end %>

            <% if current_user.student? %>
              <li>
                <a class="js-nav-link" href="#/dashboard/<%= current_user.id %>">Home</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/progress/<%= current_user.id %>">My Progress</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/expectations/<%= current_user.id %>">My Expectations</a>
              </li>
              <li>
                <a class="js-nav-link" href="#/user_assignments/<%= current_user.id %>">My Tasks</a>
              </li>
            <% end %>

            <li class="dropdown cog js-cog">
	            <div class="current-name">
  	            <% if current_user.super_admin? %>
                  Administrator
                <% else %>
                  <%= current_user.first_last_initial %>
                <% end %>
	            </div>
              <span class="glyphicon glyphicon-cog"></span>
              <div class="submenu js-submenu">
                <div class="submenu__link">
                  <a class="js-nav-link" href="#/profile/<%= current_user.id %>">Profile</a>
                </div>
                <div class="submenu__link">
                  <%= link_to('Logout', destroy_user_session_path, :method => :delete) %>
                </div>
              </div>
            </li>
          </ul>
        </nav>
      </div>
    </header>
    <div class="mask"></div>
    <div data-ng-view ng-if="!reload_required"></div>
    <div ng-if="reload_required" style="padding: 30px; text-align: center;">
      <h4>Oops! We recenty updated Imua and we noticed you are using an old version.</h4>
      <h5>Please refresh your browser window to get the updates!</h5>
    </div>
  </body>

  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', '<%= ENV["GA_TRACKING_ID"] %>',
    <% if ENV["RAILS_ENV"] == 'development' %>
      { 'cookieDomain': 'none'}
    <% else %>
      'auto'
    <% end %>
    );

    $(document).ready(function(){
      hideMenu();

      $('.js-cog').click(function(){
        $('.js-submenu').toggle();

        $('.mask').toggle();
        $('.mask').height($(window).height());
        $('.mask').width($(window).width());
      });

      $('.js-nav-link').click(function(e) {
        hideMenu();

        e.stopPropagation();
      });

      $('.mask').click(function(e) {
        hideMenu();
        e.stopPropagation();
      })

      function hideMenu() {
        $('.js-submenu').hide();
        $('.mask').hide();
      }

    });
  </script>
</html>
